# ğŸš€ Coin æ’ä»¶åŠŸèƒ½å¢å¼ºè®¡åˆ’

## ğŸ“‹ éœ€æ±‚æ€»ç»“

### 1. **å›¾æ ‡ç³»ç»Ÿå‡çº§**
- ä½¿ç”¨ FontAwesome Free å›¾æ ‡ï¼ˆDiscourse è‡ªå¸¦ï¼‰
- æ›¿æ¢æ‰€æœ‰æ¨¡æ¿ä¸­çš„ emoji å›¾æ ‡

### 2. **å‘ç¥¨ç®¡ç†åŠŸèƒ½å¢å¼º**
- ç”¨æˆ·ç•Œé¢æ–°å¢"å‘ç¥¨ç®¡ç†"é¡µé¢ï¼ŒæŸ¥çœ‹å‘ç¥¨ç”³è¯·è¿›åº¦å’Œç»“æœ
- åœ¨ç§¯åˆ†è¯¦æƒ…é¡µé¢ï¼Œå……å€¼è®°å½•æ˜¾ç¤º"ç”³è¯·å¼€å‘ç¥¨"æŒ‰é’®ï¼ˆå½“ `coin_invoice_enabled` ä¸º true æ—¶ï¼‰
- ç”¨æˆ·æäº¤ç”³è¯·åï¼Œç®¡ç†å‘˜æ”¶åˆ°é€šçŸ¥
- ç®¡ç†å‘˜ä¸Šä¼ å‘ç¥¨å›¾ç‰‡ URLï¼Œè‡ªåŠ¨æ ‡è®°ä¸ºå·²å¤„ç†
- ç”¨æˆ·åœ¨å‘ç¥¨ç®¡ç†é¡µé¢å¯ä»¥çœ‹åˆ°å‘ç¥¨å›¾ç‰‡ URL

### 3. **ç®¡ç†å‘˜ç•Œé¢å¼€å‘**
- åŠ å‡æŒ‡å®šç”¨æˆ·ç§¯åˆ†åŠŸèƒ½
- æŸ¥çœ‹æœ€è¿‘å……å€¼è®°å½•
- å…¨ç«™ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡
- å‘ç¥¨ç”³è¯·ç»Ÿè®¡ï¼ˆå¾…åŠäº‹é¡¹ï¼‰
- å‘ç¥¨ç”³è¯·å¤„ç†ï¼ˆä¸Šä¼ å‘ç¥¨ URLï¼‰

---

## ğŸ“¦ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“å’Œæ¨¡å‹æ›´æ–°

#### 1.1 åˆ›å»ºæ•°æ®åº“è¿ç§»æ–‡ä»¶
- **æ–°å»º** `db/migrate/20240101000004_add_invoice_url_to_coin_invoice_requests.rb`
  - æ·»åŠ  `invoice_url` å­—æ®µåˆ° `coin_invoice_requests` è¡¨ï¼ˆå­˜å‚¨å‘ç¥¨å›¾ç‰‡ URLï¼‰
  - æ·»åŠ ç´¢å¼•

#### 1.2 æ›´æ–°æ•°æ®æ¨¡å‹
- **ä¿®æ”¹** `app/models/my_plugin_module/coin_invoice_request.rb`
  - æ·»åŠ  `invoice_url` å­—æ®µéªŒè¯
  - æ·»åŠ  `invoice_url` è®¿é—®å™¨

### ç¬¬äºŒé˜¶æ®µï¼šåç«¯æœåŠ¡å±‚å¢å¼º

#### 2.1 æ›´æ–°å‘ç¥¨æœåŠ¡
- **ä¿®æ”¹** `lib/my_plugin_module/invoice_service.rb`
  - æ·»åŠ  `create_invoice_from_transaction` æ–¹æ³•ï¼ˆä»äº¤æ˜“è®°å½•åˆ›å»ºå‘ç¥¨ç”³è¯·ï¼‰
  - æ·»åŠ  `process_invoice` æ–¹æ³•ï¼ˆä¸Šä¼ å‘ç¥¨ URL å¹¶æ ‡è®°ä¸ºå·²å¤„ç†ï¼‰
  - ä¿®æ”¹ `get_invoice_requests` æ–¹æ³•ï¼Œè¿”å› `invoice_url` å­—æ®µ
  - ä¿®æ”¹ `get_all_invoice_requests` æ–¹æ³•ï¼Œè¿”å› `invoice_url` å­—æ®µ

#### 2.2 æ›´æ–°ç§¯åˆ†æœåŠ¡
- **ä¿®æ”¹** `lib/my_plugin_module/coin_service.rb`
  - æ·»åŠ  `get_recent_recharges` æ–¹æ³•ï¼ˆè·å–æœ€è¿‘å……å€¼è®°å½•ï¼‰
  - æ·»åŠ  `get_statistics` æ–¹æ³•ï¼ˆå…¨ç«™ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡ï¼‰

#### 2.3 åˆ›å»ºç®¡ç†å‘˜æ§åˆ¶å™¨
- **æ–°å»º** `app/controllers/my_plugin_module/admin_controller.rb`
  - `index`ï¼šç®¡ç†å‘˜ä¸»é¡µ
  - `adjust_points`ï¼šåŠ å‡æŒ‡å®šç”¨æˆ·ç§¯åˆ†
  - `recent_transactions`ï¼šæœ€è¿‘å……å€¼è®°å½•
  - `user_statistics`ï¼šå…¨ç«™ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡
  - `pending_invoices`ï¼šå¾…å¤„ç†å‘ç¥¨åˆ—è¡¨
  - `process_invoice`ï¼šå¤„ç†å‘ç¥¨ç”³è¯·ï¼ˆä¸Šä¼  URLï¼‰

#### 2.4 æ›´æ–°å‘ç¥¨æ§åˆ¶å™¨
- **ä¿®æ”¹** `app/controllers/my_plugin_module/invoice_controller.rb`
  - æ·»åŠ  `create_from_transaction` æ–¹æ³•ï¼ˆä»äº¤æ˜“è®°å½•åˆ›å»ºå‘ç¥¨ç”³è¯·ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼šè·¯ç”±é…ç½®æ›´æ–°

#### 3.1 æ›´æ–°è·¯ç”±é…ç½®
- **ä¿®æ”¹** `config/routes.rb`
  - æ·»åŠ ç®¡ç†å‘˜è·¯ç”±ï¼š
    - `get "/admin" => "admin#index"`
    - `post "/admin/adjust_points" => "admin#adjust_points"`
    - `get "/admin/recent_transactions" => "admin#recent_transactions"`
    - `get "/admin/user_statistics" => "admin#user_statistics"`
    - `get "/admin/pending_invoices" => "admin#pending_invoices"`
    - `post "/admin/process_invoice" => "admin#process_invoice"`
  - æ·»åŠ å‘ç¥¨åˆ›å»ºè·¯ç”±ï¼š
    - `post "/invoice/create_from_transaction" => "invoice#create_from_transaction"`

### ç¬¬å››é˜¶æ®µï¼šå‰ç«¯å¼€å‘

#### 4.1 æ›´æ–°å‰ç«¯è·¯ç”±æ˜ å°„
- **ä¿®æ”¹** `assets/javascripts/discourse/coin-route-map.js`
  - æ·»åŠ ç®¡ç†å‘˜è·¯ç”±ï¼š`this.route("admin", { path: "/admin" })`

#### 4.2 åˆ›å»ºå‰ç«¯è·¯ç”±å¤„ç†å™¨
- **æ–°å»º** `assets/javascripts/discourse/routes/coin-admin.js`
  - `model()`ï¼šåŠ è½½ç®¡ç†å‘˜æ•°æ®ï¼ˆç»Ÿè®¡ã€å¾…å¤„ç†å‘ç¥¨ã€æœ€è¿‘äº¤æ˜“ï¼‰

#### 4.3 åˆ›å»ºå‰ç«¯æ§åˆ¶å™¨
- **ä¿®æ”¹** `assets/javascripts/discourse/controllers/coin.js`
  - æ·»åŠ  `siteSettings` æœåŠ¡æ³¨å…¥
  - æ·»åŠ  `coinInvoiceEnabled` è®¡ç®—å±æ€§
  - æ·»åŠ  `openInvoiceFromTransactionModal` æ–¹æ³•
  - æ·»åŠ  `submitInvoiceFromTransaction` æ–¹æ³•
  - æ·»åŠ  `showApplyInvoiceButton` è®¡ç®—å±æ€§ï¼ˆåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºç”³è¯·å‘ç¥¨æŒ‰é’®ï¼‰

- **æ–°å»º** `assets/javascripts/discourse/controllers/coin-admin.js`
  - ç®¡ç†å‘˜è°ƒæ•´ç§¯åˆ†åŠŸèƒ½
  - æŸ¥çœ‹æœ€è¿‘å……å€¼è®°å½•
  - æŸ¥çœ‹å…¨ç«™ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡
  - æŸ¥çœ‹å¾…å¤„ç†å‘ç¥¨åˆ—è¡¨
  - å¤„ç†å‘ç¥¨ç”³è¯·ï¼ˆä¸Šä¼  URLï¼‰

#### 4.4 æ›´æ–°å‰ç«¯æ¨¡æ¿
- **ä¿®æ”¹** `assets/javascripts/discourse/templates/coin.hbs`
  - æ›¿æ¢æ‰€æœ‰ emoji ä¸º FontAwesome å›¾æ ‡
  - åœ¨å……å€¼è®°å½•é¡¹ä¸­æ·»åŠ "ç”³è¯·å¼€å‘ç¥¨"æŒ‰é’®ï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼‰
  - æ·»åŠ "ä»äº¤æ˜“ç”³è¯·å‘ç¥¨"æ¨¡æ€æ¡†

- **ä¿®æ”¹** `assets/javascripts/discourse/templates/coin-invoice.hbs`
  - æ›¿æ¢æ‰€æœ‰ emoji ä¸º FontAwesome å›¾æ ‡
  - åœ¨å·²å¼€ç¥¨åˆ—è¡¨ä¸­æ˜¾ç¤ºå‘ç¥¨å›¾ç‰‡ URL

- **æ–°å»º** `assets/javascripts/discourse/templates/coin-admin.hbs`
  - ç®¡ç†å‘˜ä¸»é¡µæ¨¡æ¿
  - åŒ…å«ï¼šç§¯åˆ†è°ƒæ•´è¡¨å•ã€æœ€è¿‘å……å€¼è®°å½•ã€ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡ã€å¾…å¤„ç†å‘ç¥¨åˆ—è¡¨

#### 4.5 æ›´æ–°æ ·å¼æ–‡ä»¶
- **ä¿®æ”¹** `assets/stylesheets/coin.scss`
  - æ·»åŠ  FontAwesome å›¾æ ‡æ ·å¼
  - æ·»åŠ ç®¡ç†å‘˜ç•Œé¢æ ·å¼
  - æ·»åŠ "ç”³è¯·å¼€å‘ç¥¨"æŒ‰é’®æ ·å¼
  - æ·»åŠ å‘ç¥¨å›¾ç‰‡æ˜¾ç¤ºæ ·å¼

---

## ğŸ¯ å…³é”®åŠŸèƒ½ç‚¹

### 1. **ä»äº¤æ˜“è®°å½•ç”³è¯·å‘ç¥¨**
- ç”¨æˆ·åœ¨ç§¯åˆ†è¯¦æƒ…é¡µé¢ï¼Œå……å€¼è®°å½•æ—è¾¹æ˜¾ç¤º"ç”³è¯·å¼€å‘ç¥¨"æŒ‰é’®
- ç‚¹å‡»åå¼¹å‡ºæ¨¡æ€æ¡†ï¼Œè‡ªåŠ¨å¡«å……è¯¥äº¤æ˜“çš„é‡‘é¢
- æäº¤ååˆ›å»ºå‘ç¥¨ç”³è¯·ï¼Œå…³è”åˆ°è¯¥äº¤æ˜“è®°å½•

### 2. **ç®¡ç†å‘˜å¤„ç†å‘ç¥¨**
- ç®¡ç†å‘˜åœ¨å¾…å¤„ç†å‘ç¥¨åˆ—è¡¨ä¸­æŸ¥çœ‹æ‰€æœ‰å¾…å¤„ç†ç”³è¯·
- ç‚¹å‡»"å¤„ç†"æŒ‰é’®ï¼Œä¸Šä¼ å‘ç¥¨å›¾ç‰‡ URL
- æäº¤åè‡ªåŠ¨æ ‡è®°ä¸ºå·²å¤„ç†ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°å‘ç¥¨å›¾ç‰‡

### 3. **ç®¡ç†å‘˜ç»Ÿè®¡é¢æ¿**
- å…¨ç«™ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡ï¼ˆæ€»ç§¯åˆ†ã€ç”¨æˆ·æ•°ã€å¹³å‡ç§¯åˆ†ï¼‰
- æœ€è¿‘å……å€¼è®°å½•ï¼ˆæœ€è¿‘ 20 æ¡ï¼‰
- å¾…å¤„ç†å‘ç¥¨åˆ—è¡¨ï¼ˆå¾…åŠäº‹é¡¹ï¼‰

### 4. **FontAwesome å›¾æ ‡æ˜ å°„**
```
ğŸ’° â†’ fa-solid fa-coins
âš™ï¸ â†’ fa-solid fa-gear
ğŸ’¸ â†’ fa-solid fa-arrow-trend-down
ğŸ“„ â†’ fa-solid fa-file-invoice
ğŸ“‹ â†’ fa-solid fa-clipboard-list
ğŸ”„ â†’ fa-solid fa-rotate
â³ â†’ fa-solid fa-clock
âœ… â†’ fa-solid fa-circle-check
ğŸ“­ â†’ fa-solid fa-folder-open
```

---

## ğŸ“ æœ€ç»ˆæ–‡ä»¶ç»“æ„

```
e:\code\
â”œâ”€â”€ db/
â”‚   â””â”€â”€ migrate/
â”‚       â”œâ”€â”€ 20240101000004_add_invoice_url_to_coin_invoice_requests.rb  # âœ… æ–°å»º
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ my_plugin_module/
â”‚   â”‚       â””â”€â”€ coin_invoice_request.rb  # âœ… ä¿®æ”¹
â”‚   â””â”€â”€ controllers/
â”‚       â””â”€â”€ my_plugin_module/
â”‚           â”œâ”€â”€ admin_controller.rb  # âœ… æ–°å»º
â”‚           â”œâ”€â”€ coin_controller.rb  # âœ… ä¿ç•™
â”‚           â””â”€â”€ invoice_controller.rb  # âœ… ä¿®æ”¹
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ my_plugin_module/
â”‚       â”œâ”€â”€ coin_service.rb  # âœ… ä¿®æ”¹
â”‚       â””â”€â”€ invoice_service.rb  # âœ… ä¿®æ”¹
â”œâ”€â”€ config/
â”‚   â””â”€â”€ routes.rb  # âœ… ä¿®æ”¹
â””â”€â”€ assets/
    â”œâ”€â”€ javascripts/
    â”‚   â””â”€â”€ discourse/
    â”‚       â”œâ”€â”€ coin-route-map.js  # âœ… ä¿®æ”¹
    â”‚       â”œâ”€â”€ routes/
    â”‚       â”‚   â””â”€â”€ coin-admin.js  # âœ… æ–°å»º
    â”‚       â”œâ”€â”€ controllers/
    â”‚       â”‚   â”œâ”€â”€ coin.js  # âœ… ä¿®æ”¹
    â”‚       â”‚   â”œâ”€â”€ coin-invoice.js  # âœ… ä¿ç•™
    â”‚       â”‚   â””â”€â”€ coin-admin.js  # âœ… æ–°å»º
    â”‚       â””â”€â”€ templates/
    â”‚           â”œâ”€â”€ coin.hbs  # âœ… ä¿®æ”¹
    â”‚           â”œâ”€â”€ coin-invoice.hbs  # âœ… ä¿®æ”¹
    â”‚           â””â”€â”€ coin-admin.hbs  # âœ… æ–°å»º
    â””â”€â”€ stylesheets/
        â””â”€â”€ coin.scss  # âœ… ä¿®æ”¹
```

---

## âœ¨ æŠ€æœ¯äº®ç‚¹

1. **FontAwesome å›¾æ ‡**ï¼šä½¿ç”¨ Discourse è‡ªå¸¦çš„ FontAwesome Free å›¾æ ‡åº“
2. **æ¡ä»¶æ˜¾ç¤º**ï¼šæ ¹æ® `coin_invoice_enabled` è®¾ç½®åŠ¨æ€æ˜¾ç¤º"ç”³è¯·å¼€å‘ç¥¨"æŒ‰é’®
3. **äº¤æ˜“å…³è”**ï¼šå‘ç¥¨ç”³è¯·å…³è”åˆ°å…·ä½“çš„äº¤æ˜“è®°å½•
4. **å›¾ç‰‡ URL**ï¼šç®¡ç†å‘˜ä¸Šä¼ å‘ç¥¨å›¾ç‰‡ URLï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥æŸ¥çœ‹
5. **ç»Ÿè®¡é¢æ¿**ï¼šå®Œæ•´çš„ç®¡ç†å‘˜ç»Ÿè®¡åŠŸèƒ½
6. **å®æ—¶æ›´æ–°**ï¼šç®¡ç†å‘˜å¤„ç†åï¼Œç”¨æˆ·ç•Œé¢å®æ—¶æ˜¾ç¤ºå‘ç¥¨å›¾ç‰‡

---

## ğŸ“ å®æ–½æ­¥éª¤

1. åˆ›å»ºæ•°æ®åº“è¿ç§»æ–‡ä»¶
2. æ›´æ–°æ•°æ®æ¨¡å‹
3. æ›´æ–°æœåŠ¡å±‚
4. åˆ›å»ºç®¡ç†å‘˜æ§åˆ¶å™¨
5. æ›´æ–°è·¯ç”±é…ç½®
6. æ›´æ–°å‰ç«¯è·¯ç”±
7. æ›´æ–°å‰ç«¯æ§åˆ¶å™¨
8. æ›´æ–°å‰ç«¯æ¨¡æ¿ï¼ˆæ›¿æ¢å›¾æ ‡ï¼‰
9. æ›´æ–°æ ·å¼æ–‡ä»¶

é¢„è®¡ä¿®æ”¹ 11 ä¸ªæ–‡ä»¶ï¼Œæ–°å»º 4 ä¸ªæ–‡ä»¶ã€‚