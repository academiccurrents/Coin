# ğŸ› Coin æ’ä»¶é—®é¢˜ä¿®å¤è®¡åˆ’

## ğŸ“‹ é—®é¢˜åˆ†æ

### é—®é¢˜ 1ï¼šè®¿é—® /coin/admin æ§åˆ¶å°æŠ¥é”™
**é”™è¯¯ä¿¡æ¯**ï¼š`coin-admin.js:18 åŠ è½½ç®¡ç†å‘˜æ•°æ®å¤±è´¥`

**å¯èƒ½åŸå› **ï¼š
1. API ç«¯ç‚¹è¿”å›çš„æ•°æ®ç»“æ„ä¸åŒ¹é…
2. éç®¡ç†å‘˜ç”¨æˆ·è®¿é—®æ—¶æƒé™éªŒè¯å¤±è´¥
3. è·¯ç”±å¤„ç†å™¨è¿”å›çš„æ•°æ®ç»“æ„é”™è¯¯

**é—®é¢˜å®šä½**ï¼š
- `coin-admin.js:18` å¯¹åº” `console.error("åŠ è½½ç®¡ç†å‘˜æ•°æ®å¤±è´¥:", error)`
- æŸ¥çœ‹ `coin-admin.js` è·¯ç”±å¤„ç†å™¨ï¼Œå‘ç°è¿”å›çš„æ•°æ®ç»“æ„æ˜¯ï¼š
  ```javascript
  return {
    statistics: statisticsResult.statistics || {},
    recentTransactions: transactionsResult.transactions || [],
    pendingInvoices: invoicesResult.invoices || []
  };
  ```
- ä½† API ç«¯ç‚¹å¯èƒ½è¿”å›çš„æ˜¯ `invoices` è€Œä¸æ˜¯ `pendingInvoices`

### é—®é¢˜ 2ï¼šç”³è¯·å‘ç¥¨æ¨¡æ€æ¡†ä¸å±…ä¸­ï¼Œåå·¦ä¸‹è§’ï¼Œæ— æ³•ç¼–è¾‘ï¼Œé»‘å±
**é—®é¢˜å®šä½**ï¼š
1. æ¨¡æ€æ¡†ä¸å±…ä¸­ï¼š`.coin-modal` ä½¿ç”¨äº† `width: 90%`ï¼Œä½†æ²¡æœ‰è®¾ç½® `margin: 0 auto`
2. é»‘å±é—®é¢˜ï¼šå¯èƒ½æ˜¯ z-index å±‚çº§é—®é¢˜ï¼Œæˆ–è€…èƒŒæ™¯é®ç½©æ²¡æœ‰æ­£ç¡®æ˜¾ç¤º
3. æ— æ³•ç¼–è¾‘ï¼šå¯èƒ½æ˜¯è¾“å…¥æ¡†è¢«ç¦ç”¨æˆ–è€…äº‹ä»¶è¢«é˜»æ­¢

**CSS é—®é¢˜**ï¼š
- `.coin-modal` æ ·å¼ï¼š
  ```scss
  .coin-modal {
    background: white !important;
    border-radius: 20px !important;
    max-width: 480px !important;
    width: 90% !important;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
    animation: modalSlideIn 0.3s ease !important;
  }
  ```
- ç¼ºå°‘ `margin: 0 auto` æ¥å±…ä¸­
- å¯èƒ½ç¼ºå°‘ `position: relative` ç¡®ä¿æ­£ç¡®çš„å®šä½

---

## ğŸ“¦ ä¿®å¤è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šä¿®å¤ç®¡ç†å‘˜é¡µé¢åŠ è½½é”™è¯¯

#### 1.1 æ£€æŸ¥ API ç«¯ç‚¹è¿”å›æ•°æ®ç»“æ„
- **ä¿®æ”¹** `app/controllers/my_plugin_module/admin_controller.rb`
  - æ£€æŸ¥ `pending_invoices` æ–¹æ³•è¿”å›çš„æ•°æ®ç»“æ„
  - ç¡®ä¿è¿”å›çš„æ˜¯ `invoices` è€Œä¸æ˜¯å…¶ä»–å­—æ®µå

#### 1.2 ä¿®å¤è·¯ç”±å¤„ç†å™¨æ•°æ®æ˜ å°„
- **ä¿®æ”¹** `assets/javascripts/discourse/routes/coin-admin.js`
  - ä¿®å¤æ•°æ®ç»“æ„æ˜ å°„
  - ç¡®ä¿ `pendingInvoices` æ­£ç¡®è·å–æ•°æ®

#### 1.3 æ·»åŠ ç®¡ç†å‘˜æƒé™æ£€æŸ¥
- **ä¿®æ”¹** `app/controllers/my_plugin_module/admin_controller.rb`
  - åœ¨æ‰€æœ‰ç®¡ç†å‘˜æ–¹æ³•ä¸­æ·»åŠ  `ensure_admin` æƒé™æ£€æŸ¥
  - ç¡®ä¿éç®¡ç†å‘˜ç”¨æˆ·æ— æ³•è®¿é—®

#### 1.4 æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- **ä¿®æ”¹** `assets/javascripts/discourse/routes/coin-admin.js`
  - æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
  - æ·»åŠ ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

---

### ç¬¬äºŒé˜¶æ®µï¼šä¿®å¤æ¨¡æ€æ¡†å±…ä¸­å’Œç¼–è¾‘é—®é¢˜

#### 2.1 ä¿®å¤æ¨¡æ€æ¡†å±…ä¸­
- **ä¿®æ”¹** `assets/stylesheets/coin.scss`
  - ä¸º `.coin-modal` æ·»åŠ  `margin: 0 auto`
  - æ·»åŠ  `position: relative` ç¡®ä¿æ­£ç¡®çš„å®šä½
  - ä¿®æ”¹ä¸ºï¼š
    ```scss
    .coin-modal {
      background: white !important;
      border-radius: 20px !important;
      max-width: 480px !important;
      width: 90% !important;
      margin: 0 auto !important;
      position: relative !important;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
      animation: modalSlideIn 0.3s ease !important;
    }
    ```

#### 2.2 ä¿®å¤æ¨¡æ€æ¡† z-index å±‚çº§
- **ä¿®æ”¹** `assets/stylesheets/coin.scss`
  - æé«˜ `.coin-modal` çš„ z-index
  - ç¡®ä¿æ¨¡æ€æ¡†åœ¨èƒŒæ™¯é®ç½©ä¹‹ä¸Š
  - ä¿®æ”¹ä¸ºï¼š
    ```scss
    .coin-modal {
      z-index: 1051 !important;
    }
    ```

#### 2.3 æ£€æŸ¥è¾“å…¥æ¡†æ˜¯å¦å¯ç¼–è¾‘
- **ä¿®æ”¹** `assets/javascripts/discourse/templates/coin.hbs`
  - ç¡®ä¿è¾“å…¥æ¡†æ²¡æœ‰è¢«ç¦ç”¨
  - ç¡®ä¿äº‹ä»¶å¤„ç†å™¨æ­£ç¡®ç»‘å®š

#### 2.4 æ·»åŠ æ¨¡æ€æ¡†è°ƒè¯•æ ·å¼
- **ä¿®æ”¹** `assets/stylesheets/coin.scss`
  - æ·»åŠ ä¸´æ—¶çš„è¾¹æ¡†å’ŒèƒŒæ™¯è‰²ï¼Œæ–¹ä¾¿è°ƒè¯•
  - ç¡®ä¿æ¨¡æ€æ¡†å¯è§

---

## ğŸ“ æœ€ç»ˆæ–‡ä»¶ç»“æ„

```
e:\code\
â”œâ”€â”€ app/
â”‚   â””â”€â”€ controllers/
â”‚       â””â”€â”€ my_plugin_module/
â”‚           â””â”€â”€ admin_controller.rb  # âœ… ä¿®æ”¹ï¼ˆæ£€æŸ¥æ•°æ®ç»“æ„ï¼‰
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ javascripts/
â”‚   â”‚   â””â”€â”€ discourse/
â”‚   â”‚       â”œâ”€â”€ routes/
â”‚   â”‚       â”‚   â””â”€â”€ coin-admin.js  # âœ… ä¿®æ”¹ï¼ˆä¿®å¤æ•°æ®æ˜ å°„ï¼‰
â”‚   â”‚       â””â”€â”€ templates/
â”‚   â”‚           â””â”€â”€ coin.hbs  # âœ… æ£€æŸ¥ï¼ˆç¡®ä¿è¾“å…¥æ¡†å¯ç¼–è¾‘ï¼‰
â”‚   â””â”€â”€ stylesheets/
â”‚       â””â”€â”€ coin.scss  # âœ… ä¿®æ”¹ï¼ˆä¿®å¤æ¨¡æ€æ¡†å±…ä¸­å’Œå±‚çº§ï¼‰
â””â”€â”€ ...
```

---

## ğŸ¯ å…³é”®ä¿®å¤ç‚¹

### é—®é¢˜ 1 ä¿®å¤
1. **æ£€æŸ¥ API è¿”å›æ•°æ®ç»“æ„**ï¼šç¡®ä¿ `pending_invoices` æ–¹æ³•è¿”å›æ­£ç¡®çš„å­—æ®µå
2. **ä¿®å¤è·¯ç”±æ•°æ®æ˜ å°„**ï¼šç¡®ä¿å‰ç«¯æ­£ç¡®è·å– `pendingInvoices` æ•°æ®
3. **æ·»åŠ ç®¡ç†å‘˜æƒé™æ£€æŸ¥**ï¼šç¡®ä¿éç®¡ç†å‘˜ç”¨æˆ·æ— æ³•è®¿é—®
4. **æ·»åŠ è¯¦ç»†é”™è¯¯æ—¥å¿—**ï¼šæ–¹ä¾¿è°ƒè¯•å’Œæ’æŸ¥é—®é¢˜

### é—®é¢˜ 2 ä¿®å¤
1. **æ·»åŠ  margin: 0 auto**ï¼šç¡®ä¿æ¨¡æ€æ¡†æ°´å¹³å±…ä¸­
2. **æ·»åŠ  position: relative**ï¼šç¡®ä¿æ­£ç¡®çš„å®šä½ä¸Šä¸‹æ–‡
3. **æé«˜ z-index**ï¼šç¡®ä¿æ¨¡æ€æ¡†åœ¨èƒŒæ™¯é®ç½©ä¹‹ä¸Š
4. **æ£€æŸ¥è¾“å…¥æ¡†ç»‘å®š**ï¼šç¡®ä¿è¾“å…¥æ¡†å¯ç¼–è¾‘

---

## âœ¨ æŠ€æœ¯äº®ç‚¹

1. **æ•°æ®ç»“æ„ä¸€è‡´æ€§**ï¼šç¡®ä¿å‰åç«¯æ•°æ®ç»“æ„åŒ¹é…
2. **æƒé™éªŒè¯**ï¼šé˜²æ­¢éç®¡ç†å‘˜ç”¨æˆ·è®¿é—®ç®¡ç†å‘˜é¡µé¢
3. **CSS å®šä½ä¿®å¤**ï¼šä½¿ç”¨æ­£ç¡®çš„å®šä½å’Œå±…ä¸­æ–¹å¼
4. **z-index å±‚çº§ç®¡ç†**ï¼šç¡®ä¿æ¨¡æ€æ¡†åœ¨æ­£ç¡®çš„å±‚çº§
5. **é”™è¯¯å¤„ç†å¢å¼º**ï¼šæ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œç”¨æˆ·æç¤º

---

## ğŸ“ å®æ–½æ­¥éª¤

1. æ£€æŸ¥ç®¡ç†å‘˜æ§åˆ¶å™¨çš„ `pending_invoices` æ–¹æ³•
2. ä¿®å¤è·¯ç”±å¤„ç†å™¨çš„æ•°æ®æ˜ å°„
3. æ·»åŠ ç®¡ç†å‘˜æƒé™æ£€æŸ¥
4. ä¿®å¤æ¨¡æ€æ¡† CSS æ ·å¼ï¼ˆå±…ä¸­å’Œå±‚çº§ï¼‰
5. æ£€æŸ¥è¾“å…¥æ¡†ç»‘å®šå’Œå¯ç¼–è¾‘æ€§

é¢„è®¡ä¿®æ”¹ 4 ä¸ªæ–‡ä»¶ã€‚