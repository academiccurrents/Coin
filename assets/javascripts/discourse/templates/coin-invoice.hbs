<div class="coin-page coin-invoice-page">
  <div class="coin-container">
    {{!-- é¡¶éƒ¨å¯¼èˆªæ  --}}
    <div class="coin-nav">
      <div class="coin-nav-left">
        <button class="coin-nav-back" {{on "click" this.goToCoinPage}}>
          <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
        </button>
        <span class="coin-nav-icon">ğŸ“„</span>
        <span class="coin-nav-title">å‘ç¥¨ç®¡ç†</span>
      </div>
      <div class="coin-nav-right">
        <button class="coin-nav-btn primary" {{on "click" this.openApplyModal}}>
          <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/></svg>
          <span>ç”³è¯·å‘ç¥¨</span>
        </button>
        <button class="coin-nav-btn" {{on "click" this.refreshData}}>
          <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M105.1 202.6c7.7-21.8 20.2-42.3 37.8-59.8c62.5-62.5 163.8-62.5 226.3 0L386.3 160H352c-17.7 0-32 14.3-32 32s14.3 32 32 32h143.5c0 0 0 0 0 0c.1 0 .1 0 .2 0c17.6-.1 31.8-14.4 31.8-32V48c0-17.7-14.3-32-32-32s-32 14.3-32 32v35.2L446.4 65.9C349.8-30.7 193.8-30.7 97.2 65.9c-28.7 28.7-49.5 63.6-60.8 101.4c-4.5 15.1 4.1 31 19.2 35.5s31-4.1 35.5-19.2z"/></svg>
        </button>
      </div>
    </div>

    {{!-- å¾…å¼€ç¥¨ --}}
    <div class="coin-section">
      <div class="section-header">
        <h2 class="section-title">
          <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256z"/></svg>
          <span>å¾…å¼€ç¥¨</span>
        </h2>
        <span class="section-badge warning">{{this.pendingInvoices.length}}</span>
      </div>
      <div class="invoice-list">
        {{#if this.pendingInvoices}}
          {{#each this.pendingInvoices as |invoice|}}
            <div class="invoice-card pending">
              <div class="invoice-left">
                <div class="invoice-icon pending">â³</div>
                <div class="invoice-info">
                  <span class="invoice-amount">Â¥{{invoice.amount}}</span>
                  <span class="invoice-type-badge {{invoice.invoice_type}}">
                    {{invoice.invoice_type_text}}
                  </span>
                  <span class="invoice-title">{{invoice.invoice_title}}</span>
                  {{#if invoice.out_trade_no}}
                    <span class="invoice-order">è®¢å•: {{invoice.out_trade_no}}</span>
                  {{/if}}
                  <span class="invoice-date">{{format-date invoice.created_at format="medium"}}</span>
                </div>
              </div>
              <div class="invoice-right">
                <button class="invoice-edit-btn" {{on "click" (fn this.openEditModal invoice)}}>
                  âœï¸ ç¼–è¾‘
                </button>
                <div class="invoice-status pending">å¾…å¤„ç†</div>
              </div>
            </div>
          {{/each}}
        {{else}}
          <div class="empty-state small">
            <span>æš‚æ— å¾…å¼€ç¥¨è®°å½•</span>
          </div>
        {{/if}}
      </div>
    </div>

    {{!-- å·²æ‹’ç» --}}
    {{#if this.rejectedInvoices.length}}
    <div class="coin-section">
      <div class="section-header">
        <h2 class="section-title">
          <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"/></svg>
          <span>å·²æ‹’ç»</span>
        </h2>
        <span class="section-badge danger">{{this.rejectedInvoices.length}}</span>
      </div>
      <div class="invoice-list">
        {{#each this.rejectedInvoices as |invoice|}}
          <div class="invoice-card rejected">
            <div class="invoice-left">
              <div class="invoice-icon rejected">âŒ</div>
              <div class="invoice-info">
                <span class="invoice-amount">Â¥{{invoice.amount}}</span>
                <span class="invoice-type-badge {{invoice.invoice_type}}">
                  {{invoice.invoice_type_text}}
                </span>
                <span class="invoice-title">{{invoice.invoice_title}}</span>
                {{#if invoice.reject_reason}}
                  <span class="invoice-reject-reason">æ‹’ç»åŸå› : {{invoice.reject_reason}}</span>
                {{/if}}
                <span class="invoice-date">{{format-date invoice.updated_at format="medium"}}</span>
              </div>
            </div>
            <div class="invoice-status rejected">å·²æ‹’ç»</div>
          </div>
        {{/each}}
      </div>
    </div>
    {{/if}}

    {{!-- å·²å¼€ç¥¨ --}}
    <div class="coin-section">
      <div class="section-header">
        <h2 class="section-title">
          <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/></svg>
          <span>å·²å¼€ç¥¨</span>
        </h2>
        <span class="section-badge success">{{this.completedInvoices.length}}</span>
      </div>
      <div class="invoice-list">
        {{#if this.completedInvoices}}
          {{#each this.completedInvoices as |invoice|}}
            <div class="invoice-card completed">
              <div class="invoice-left">
                <div class="invoice-icon completed">âœ…</div>
                <div class="invoice-info">
                  <span class="invoice-amount">Â¥{{invoice.amount}}</span>
                  <span class="invoice-type-badge {{invoice.invoice_type}}">
                    {{invoice.invoice_type_text}}
                  </span>
                  <span class="invoice-title">{{invoice.invoice_title}}</span>
                  <span class="invoice-date">{{format-date invoice.updated_at format="medium"}}</span>
                </div>
              </div>
              <div class="invoice-right">
                {{#if invoice.invoice_url}}
                  <a href="{{invoice.invoice_url}}" target="_blank" rel="noopener noreferrer" class="invoice-view-btn">
                    æŸ¥çœ‹å‘ç¥¨
                  </a>
                {{/if}}
                <div class="invoice-status completed">å·²å®Œæˆ</div>
              </div>
            </div>
          {{/each}}
        {{else}}
          <div class="empty-state small">
            <span>æš‚æ— å·²å¼€ç¥¨è®°å½•</span>
          </div>
        {{/if}}
      </div>
    </div>
  </div>

  {{!-- ç”³è¯·å‘ç¥¨å¼¹çª— --}}
  {{#if this.showApplyModal}}
  <div class="coin-modal-backdrop" {{on "click" this.closeApplyModal}}>
    <div class="coin-modal" {{on "click" (fn (mut this._noop) true)}}>
      <div class="coin-modal-header">
        <h3>ç”³è¯·å‘ç¥¨</h3>
        <button class="coin-modal-close" {{on "click" this.closeApplyModal}}>Ã—</button>
      </div>
      <div class="coin-modal-body">
        {{!-- é€‰æ‹©è®¢å• --}}
        <div class="form-group">
          <label>é€‰æ‹©è®¢å•</label>
          {{#if this.eligibleOrders.length}}
            <div class="order-list">
              {{#each this.eligibleOrders as |order|}}
                <div class="order-item {{if (eq this.selectedOrder order) 'selected'}}" 
                     {{on "click" (fn this.selectOrder order)}}>
                  <div class="order-info">
                    <span class="order-no">{{order.out_trade_no}}</span>
                    <span class="order-amount">Â¥{{order.actual_price}}</span>
                  </div>
                  <span class="order-date">{{format-date order.created_at format="medium"}}</span>
                </div>
              {{/each}}
            </div>
          {{else}}
            <div class="empty-orders">æš‚æ— å¯å¼€ç¥¨çš„è®¢å•</div>
          {{/if}}
        </div>

        {{#if this.selectedOrder}}
        {{!-- å‘ç¥¨ç±»å‹ --}}
        <div class="form-group">
          <label>å‘ç¥¨ç±»å‹</label>
          <div class="invoice-type-selector">
            <button class="type-btn {{if this.isPersonal 'active'}}" 
                    {{on "click" (fn this.setInvoiceType "personal")}}>
              ğŸ‘¤ ä¸ªäºº
            </button>
            <button class="type-btn {{unless this.isPersonal 'active'}}" 
                    {{on "click" (fn this.setInvoiceType "company")}}>
              ğŸ¢ ä¼ä¸š
            </button>
          </div>
        </div>

        {{!-- å‘ç¥¨æŠ¬å¤´ --}}
        <div class="form-group">
          <label>{{if this.isPersonal "å§“å" "å…¬å¸åç§°"}} <span class="required">*</span></label>
          <input type="text" 
                 class="form-input" 
                 placeholder="{{if this.isPersonal 'è¯·è¾“å…¥æ‚¨çš„å§“å' 'è¯·è¾“å…¥å…¬å¸å…¨ç§°'}}"
                 value={{this.invoiceTitle}}
                 {{on "input" this.updateInvoiceTitle}} />
        </div>

        {{!-- ä¸ªäººï¼šèº«ä»½è¯å· --}}
        {{#if this.isPersonal}}
        <div class="form-group">
          <label>èº«ä»½è¯å·ç  <span class="required">*</span></label>
          <input type="text" 
                 class="form-input" 
                 placeholder="è¯·è¾“å…¥èº«ä»½è¯å·ç "
                 value={{this.idNumber}}
                 {{on "input" this.updateIdNumber}} />
        </div>
        {{else}}
        {{!-- ä¼ä¸šï¼šçº³ç¨äººè¯†åˆ«å· --}}
        <div class="form-group">
          <label>çº³ç¨äººè¯†åˆ«å· <span class="required">*</span></label>
          <input type="text" 
                 class="form-input" 
                 placeholder="è¯·è¾“å…¥çº³ç¨äººè¯†åˆ«å·"
                 value={{this.taxNumber}}
                 {{on "input" this.updateTaxNumber}} />
        </div>
        {{/if}}
        {{/if}}
      </div>
      <div class="coin-modal-footer">
        <button class="btn-cancel" {{on "click" this.closeApplyModal}}>å–æ¶ˆ</button>
        <button class="btn-submit {{unless this.canSubmitApply 'disabled'}}" 
                disabled={{unless this.canSubmitApply true}}
                {{on "click" this.submitApply}}>
          {{if this.isLoading "æäº¤ä¸­..." "æäº¤ç”³è¯·"}}
        </button>
      </div>
    </div>
  </div>
  {{/if}}

  {{!-- ç¼–è¾‘å‘ç¥¨å¼¹çª— --}}
  {{#if this.showEditModal}}
  <div class="coin-modal-backdrop" {{on "click" this.closeEditModal}}>
    <div class="coin-modal" {{on "click" (fn (mut this._noop) true)}}>
      <div class="coin-modal-header">
        <h3>ç¼–è¾‘å‘ç¥¨ä¿¡æ¯</h3>
        <button class="coin-modal-close" {{on "click" this.closeEditModal}}>Ã—</button>
      </div>
      <div class="coin-modal-body">
        {{!-- å‘ç¥¨ç±»å‹ --}}
        <div class="form-group">
          <label>å‘ç¥¨ç±»å‹</label>
          <div class="invoice-type-selector">
            <button class="type-btn {{if this.isPersonal 'active'}}" 
                    {{on "click" (fn this.setInvoiceType "personal")}}>
              ğŸ‘¤ ä¸ªäºº
            </button>
            <button class="type-btn {{unless this.isPersonal 'active'}}" 
                    {{on "click" (fn this.setInvoiceType "company")}}>
              ğŸ¢ ä¼ä¸š
            </button>
          </div>
        </div>

        {{!-- å‘ç¥¨æŠ¬å¤´ --}}
        <div class="form-group">
          <label>{{if this.isPersonal "å§“å" "å…¬å¸åç§°"}} <span class="required">*</span></label>
          <input type="text" 
                 class="form-input" 
                 placeholder="{{if this.isPersonal 'è¯·è¾“å…¥æ‚¨çš„å§“å' 'è¯·è¾“å…¥å…¬å¸å…¨ç§°'}}"
                 value={{this.invoiceTitle}}
                 {{on "input" this.updateInvoiceTitle}} />
        </div>

        {{!-- ä¸ªäººï¼šèº«ä»½è¯å· --}}
        {{#if this.isPersonal}}
        <div class="form-group">
          <label>èº«ä»½è¯å·ç  <span class="required">*</span></label>
          <input type="text" 
                 class="form-input" 
                 placeholder="è¯·è¾“å…¥èº«ä»½è¯å·ç "
                 value={{this.idNumber}}
                 {{on "input" this.updateIdNumber}} />
        </div>
        {{else}}
        {{!-- ä¼ä¸šï¼šçº³ç¨äººè¯†åˆ«å· --}}
        <div class="form-group">
          <label>çº³ç¨äººè¯†åˆ«å· <span class="required">*</span></label>
          <input type="text" 
                 class="form-input" 
                 placeholder="è¯·è¾“å…¥çº³ç¨äººè¯†åˆ«å·"
                 value={{this.taxNumber}}
                 {{on "input" this.updateTaxNumber}} />
        </div>
        {{/if}}
      </div>
      <div class="coin-modal-footer">
        <button class="btn-cancel" {{on "click" this.closeEditModal}}>å–æ¶ˆ</button>
        <button class="btn-submit {{unless this.canSubmitEdit 'disabled'}}" 
                disabled={{unless this.canSubmitEdit true}}
                {{on "click" this.submitEdit}}>
          {{if this.isLoading "ä¿å­˜ä¸­..." "ä¿å­˜ä¿®æ”¹"}}
        </button>
      </div>
    </div>
  </div>
  {{/if}}

  {{!-- æˆåŠŸæç¤º --}}
  {{#if this.showSuccessMessage}}
    <div class="coin-toast success">
      <span>{{this.successMessage}}</span>
    </div>
  {{/if}}
</div>
